<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      grit| commit &middot; A coding blog by Jam
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-0c">

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          <span style="color: #FF6347; font: Verdana">grit| commit</span>
        </a>
      </h1>
      <p class="lead">daily learnings as a ruby dev</p>
    </div>



    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>

      

      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href=""></a>

            <a class="sidebar-nav-item" href="/about/">About</a>

          
        
      
        
          
            <a class="sidebar-nav-item" href=""></a>

            <a class="sidebar-nav-item" href="/archive/">Archive</a>

          
        
      
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      

    <p>&copy; 2015. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/12/15/course3-from-views-to-mockups/">
        Build Robust & Production Quality Applications: Precourse, Views to Mockups
      </a>
    </h1>

    <span class="post-date">15 Dec 2014</span>

    <h2>The Process of Building Queues from Mockups:</h2>

<h3>Building out the videos page</h3>

<h4>Step 1. Copy layout from the ui videos template</h4>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">%</span><span class="n">article</span><span class="o">.</span><span class="n">video</span>
  <span class="o">.</span><span class="n">container</span>
    <span class="o">.</span><span class="n">row</span>
      <span class="o">.</span><span class="n">video_large_cover</span><span class="o">.</span><span class="n">col</span><span class="o">-</span><span class="n">sm</span><span class="o">-</span><span class="mi">7</span><span class="o">.</span><span class="n">col</span><span class="o">-</span><span class="n">sm</span><span class="o">-</span><span class="n">offset</span><span class="o">-</span><span class="mi">1</span>
        <span class="o">%</span><span class="n">img</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s2">&quot;http://dummyimage.com/665x375/000000/00a2ff&quot;</span><span class="p">)</span>
      <span class="o">.</span><span class="n">video_info</span><span class="o">.</span><span class="n">col</span><span class="o">-</span><span class="n">sm</span><span class="o">-</span><span class="mi">3</span>
        <span class="o">%</span><span class="n">header</span>
          <span class="o">%</span><span class="n">h3</span> <span class="no">Futurama</span>
          <span class="o">%</span><span class="n">span</span> <span class="ss">Rating</span><span class="p">:</span> <span class="mi">4</span><span class="o">.</span><span class="mi">5</span><span class="o">/</span><span class="mi">5</span><span class="o">.</span><span class="mi">0</span>
        <span class="o">%</span><span class="nb">p</span> <span class="no">Pizza</span> <span class="n">boy</span> <span class="no">Philip</span> <span class="n">J</span><span class="o">.</span> <span class="no">Fry</span> <span class="n">awakens</span> <span class="k">in</span> <span class="n">the</span> <span class="mi">31</span><span class="n">st</span> <span class="n">century</span> <span class="n">after</span> <span class="mi">1</span><span class="p">,</span><span class="mo">000</span> <span class="n">years</span> <span class="n">of</span> <span class="n">cryogenic</span> <span class="n">preservation</span> <span class="k">in</span> <span class="n">this</span> <span class="n">animated</span> <span class="n">series</span><span class="o">.</span> <span class="no">After</span> <span class="n">he</span> <span class="nb">gets</span> <span class="n">a</span> <span class="n">job</span> <span class="n">at</span> <span class="n">an</span> <span class="n">interplanetary</span> <span class="n">delivery</span> <span class="n">service</span><span class="p">,</span> <span class="no">Fry</span> <span class="n">embarks</span> <span class="n">on</span> <span class="n">ridiculous</span> <span class="n">escapades</span> <span class="n">to</span> <span class="n">make</span> <span class="n">sense</span> <span class="n">of</span> <span class="n">his</span> <span class="n">predicament</span><span class="o">.</span></code></pre></div>

<h4>Step 2. Change/Remove hardcoded data for future code</h4>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">%</span><span class="n">article</span><span class="o">.</span><span class="n">video</span>
  <span class="o">.</span><span class="n">container</span>
    <span class="o">.</span><span class="n">row</span>
      <span class="o">.</span><span class="n">video_large_cover</span><span class="o">.</span><span class="n">col</span><span class="o">-</span><span class="n">sm</span><span class="o">-</span><span class="mi">7</span><span class="o">.</span><span class="n">col</span><span class="o">-</span><span class="n">sm</span><span class="o">-</span><span class="n">offset</span><span class="o">-</span><span class="mi">1</span>
        <span class="o">%</span><span class="n">img</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">#{</span><span class="vi">@video</span><span class="o">.</span><span class="n">large_cover_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
      <span class="o">.</span><span class="n">video_info</span><span class="o">.</span><span class="n">col</span><span class="o">-</span><span class="n">sm</span><span class="o">-</span><span class="mi">3</span>
        <span class="o">%</span><span class="n">header</span>
          <span class="o">%</span><span class="n">h3</span><span class="o">=</span> <span class="vi">@video</span><span class="o">.</span><span class="n">title</span>
          <span class="o">%</span><span class="n">span</span> <span class="ss">Rating</span><span class="p">:</span> <span class="mi">4</span><span class="o">.</span><span class="mi">5</span><span class="o">/</span><span class="mi">5</span><span class="o">.</span><span class="mi">0</span>
        <span class="o">%</span><span class="nb">p</span><span class="o">=</span> <span class="vi">@video</span><span class="o">.</span><span class="n">description</span></code></pre></div>

<h4>Step 3. Build Routes corresponding with future code</h4>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Myflix</span><span class="o">::</span><span class="no">Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:videos</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:show</span><span class="o">]</span>
 <span class="k">end</span></code></pre></div>

<h4>Step 4. Begin testing videos controller spec</h4>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/12/05/course3-from-design-to-dev/">
        Build Robust & Production Quality Applications: Precourse, From Design to Development
      </a>
    </h1>

    <span class="post-date">05 Dec 2014</span>

    <h2>Items Covered:</h2>

<ol>
<li>Slicing Mockups</li>
<li>SASS</li>
<li>Haml</li>
</ol>

<h2>How to serve sliced mockups pages</h2>

<h3>Slicing with UI Controllers</h3>

<p>We will use a UI controller that will point to pages that we need, such as &quot;sign in&quot; page, &quot;account page&quot;.
Currenty the data and images in these layouts/templates are hardcoded with data and images (nothing is actually linked to the database)</p>

<p>Because we don&#39;t want these templates accessible in prod, we have a before filter to ensure that that&#39;s the case:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1">#ui_controllers.rb</span>
<span class="k">class</span> <span class="nc">UiController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="n">before_filter</span> <span class="k">do</span>
    <span class="n">redirect_to</span> <span class="ss">:root</span> <span class="k">if</span> <span class="no">Rails</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">production?</span>
  <span class="k">end</span>

  <span class="n">layout</span> <span class="s2">&quot;application&quot;</span>

  <span class="k">def</span> <span class="nf">index</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<h3>In the routes:</h3>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1">#routes.rb</span>
<span class="no">Myflix</span><span class="o">::</span><span class="no">Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span><span class="o">.</span><span class="n">do</span>
  <span class="n">get</span> <span class="s1">&#39;ui/:action)&#39;</span> <span class="p">,</span> <span class="ss">controller</span><span class="p">:</span> <span class="s1">&#39;ui&#39;</span>
<span class="k">end</span></code></pre></div>

<h3>UI Index</h3>

<p>So we want our index action to show all views available with links containing (&#39;html.haml&#39;) unless its index:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">%</span><span class="n">section</span><span class="o">.</span><span class="n">ui</span><span class="o">-</span><span class="n">index</span>
  <span class="o">%</span><span class="n">ul</span>
    <span class="o">-</span> <span class="no">Dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;app/views/ui/*.html.haml&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
      <span class="o">-</span> <span class="n">wireframe</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="s1">&#39;.html.haml&#39;</span><span class="p">)</span>
      <span class="o">-</span>  <span class="k">unless</span> <span class="n">wireframe</span> <span class="o">==</span> <span class="s1">&#39;index&#39;</span> <span class="o">||</span> <span class="n">wireframe</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sr">/^_/</span><span class="p">)</span>
        <span class="o">%</span><span class="n">li</span><span class="o">=</span> <span class="n">link_to</span> <span class="n">wireframe</span><span class="o">.</span><span class="n">titleize</span><span class="p">,</span> <span class="ss">action</span><span class="p">:</span> <span class="n">wireframe</span> <span class="k">unless</span> <span class="n">wireframe</span> <span class="o">==</span> <span class="s1">&#39;index&#39;</span></code></pre></div>

<ul>
<li>To read more about UI Controllers, checkout this blog post from hashrocket:</li>
</ul>

<h2>Stylesheets</h2>

<h3>SASS</h3>

<p>In this project, we will use application.css (manifest file) that will pull in all of our required files (asset pipline). You had several options - some devs like to use 1 sass/css stylesheet for their entire app, in this case, we broke it out according to the page (user sign in, billing, etc.)</p>

<p>There are two options when using sass, sass and scss. Scss is more verobse but desgined to be compatible with vanilla css. In this case, we are using sass because its less verobse.</p>

<ul>
<li>To read more about Sass:<a href="http://sass-lang.com/guide">Sass Documentation</a></li>
</ul>

<h2>Views</h2>

<h3>HAML</h3>

<p>We are also using Haml instead of ERB. Haml appears to be more succint because it uses indentation instead of closing tags</p>

<ul>
<li><p>To read more about Haml: <a href="http://haml.info/docs.html">Haml Documentation</a></p></li>
<li><p>To read more about the asset pipeline: <a href="http://guides.rubyonrails.org/asset_pipeline.html#coding-links-to-assets">Rails Asset Pipeline</a></p></li>
</ul>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/11/27/course3-ideas-to-products/">
        Build Robust & Production Quality Applications: Precourse, From Ideas to Products
      </a>
    </h1>

    <span class="post-date">27 Nov 2014</span>

    <h2>The Process of Going from Ideas to Products</h2>

<h3>Prototype process for web applications</h3>

<h2>Step 1. You have an idea</h2>

<h2>Step 2. Build wireframes</h2>

<ul>
<li>balsamiq mockups</li>
<li>moqups.com</li>
</ul>

<h3>Purpose:</h3>

<ol>
<li>Communication: not for design but merely for commuincation (to yourself, designers, devs, and the client)</li>
<li>Workflow</li>
<li>Scoping</li>
</ol>

<h3>Points for wireframing:</h3>

<ol>
<li>Don&#39;t over design, this is to quickly put together a concept</li>
<li>When you wireframe - you want to do several versions and iterate from there. This will free your from the attachment to your idea.</li>
</ol>

<h2>Step 3. Design</h2>

<p>Provides:
* Layout
* Colors
* Typogaphy
* Look &amp; Feel
** Tools: Typically Photoshop, producing a .psd file</p>

<p>Step 4. Slicing
Taking the .psd file and turning it into mockups. At this point, you want your .psds to as pixel perfect as possible because this is where we turn the psd into html/css</p>

<p>Step 5. Development</p>

<p>The advantage of this process is that it isolates the each step into layers, allowing you to explore many alternatives at each step.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/11/22/course3-twillio/">
        Rapid Prototyping with Rails: Lesson 4, Twilio: Two-factor Auth
      </a>
    </h1>

    <span class="post-date">22 Nov 2014</span>

    <h2>Two factor authentication upon login:</h2>

<h3>Pseudo code:</h3>

<ol>
<li>We need a phone number and pin columns</li>
<li>Change login logic:</li>
</ol>

<ul>
<li>If phone number not present, normal login</li>
<li>If phone number present

<ul>
<li>generate pin to save to db, not show user</li>
<li>send pin to Twilio to sms user&#39;s phone</li>
<li>show a form to enter the pin (generate new route myapp.com/pin)</li>
<li>must ensure its secure, can only be seen after user has logged in</li>
</ul></li>
</ul>

<hr>

<h4>1. Add column phone and pin column to users:</h4>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">-</span> <span class="n">rails</span> <span class="n">g</span> <span class="n">migration</span> <span class="n">add_phone_and_pin_to_users</span></code></pre></div>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">-</span> <span class="k">class</span> <span class="nc">AddPhoneAndPinToUsers</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">add_column</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:phone</span><span class="p">,</span> <span class="ss">:string</span>
    <span class="n">add_column</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:pin</span><span class="p">,</span> <span class="ss">:string</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<h4>2. Add phone input field to your users/new.html.erb</h4>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s1">&#39;control-group&#39;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="sx">%= f.label :phone, &quot;Phone Number &lt;small&gt;(numbers only)&lt;/small&gt;&quot;.html_safe %&gt;</span>
<span class="sx">  &lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_field</span> <span class="ss">:phone</span><span class="p">,</span> <span class="ss">maxlength</span><span class="p">:</span> <span class="mi">9</span> <span class="sx">%&gt;</span>
<span class="sx">  &lt;%= link_to &#39;#&#39;, id: &#39;two_factor_phone&#39; do %&gt;</span>
    <span class="o">&lt;</span><span class="n">i</span> <span class="n">class</span><span class="o">=</span><span class="s1">&#39;icon-question-sign&#39;</span><span class="o">&gt;&lt;</span><span class="sr">/i&gt;</span>
<span class="sr">  &lt;% end %&gt;</span>
<span class="sr">&lt;/</span><span class="n">div</span><span class="o">&gt;</span></code></pre></div>

<h4>3. Also, we need to add :phone to strong_parameters</h4>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">user_params</span>
  <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:username</span><span class="p">,</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">:time_zone</span><span class="p">,</span> <span class="ss">:phone</span><span class="p">)</span>
<span class="k">end</span></code></pre></div>

<h4>4. So after the phone number is entered by the user, we want to prevent them from</h4>

<p>logging in directly and prompt them for their pin and connect with Twilio.
The login occurs in the sessions controller:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">create</span>
  <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">username</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:username</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
  <span class="k">if</span> <span class="n">user</span> <span class="o">&amp;&amp;</span> <span class="n">user</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:password</span><span class="o">]</span><span class="p">)</span>
    <span class="o">****</span><span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">two_factor_auth?</span> <span class="c1">#must create this method</span>

    <span class="k">else</span>
      <span class="n">session</span><span class="o">[</span><span class="ss">:user_id</span><span class="o">]</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span>
      <span class="n">flash</span><span class="o">[</span><span class="ss">:notice</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;Welcome, you&#39;ve logged in.&quot;</span>
      <span class="n">redirect_to</span> <span class="n">root_path</span>
    <span class="k">end</span>
  <span class="k">else</span>
    <span class="n">flash</span><span class="o">[</span><span class="ss">:error</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;There is something with your username &amp; password.&quot;</span>
    <span class="n">redirect_to</span> <span class="n">login_path</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<h4>5. Create two<em>factor</em>auth? method in your user model:</h4>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">two_factor_auth?</span>
    <span class="o">!</span><span class="nb">self</span><span class="o">.</span><span class="n">phone</span><span class="o">.</span><span class="n">blank?</span>
  <span class="k">end</span></code></pre></div>

<h4>6. We have to now breakdown what else we need</h4>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">create</span>
  <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">username</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:username</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
  <span class="k">if</span> <span class="n">user</span> <span class="o">&amp;&amp;</span> <span class="n">user</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:password</span><span class="o">]</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">two_factor_auth?</span>
      <span class="c1">#generate a pin</span>
      <span class="n">user</span><span class="o">.</span><span class="n">generate_pin!</span>
      <span class="c1">#send pin to twilio, sms user&#39;s phone</span>
      <span class="c1">#show pin form for user input after sms</span>
    <span class="k">else</span>
      <span class="n">session</span><span class="o">[</span><span class="ss">:user_id</span><span class="o">]</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span>
      <span class="n">flash</span><span class="o">[</span><span class="ss">:notice</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;Welcome, you&#39;ve logged in.&quot;</span>
      <span class="n">redirect_to</span> <span class="n">root_path</span>
    <span class="k">end</span>
  <span class="k">else</span>
    <span class="n">flash</span><span class="o">[</span><span class="ss">:error</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;There is something with your username &amp; password.&quot;</span>
    <span class="n">redirect_to</span> <span class="n">login_path</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<h4>7. Create generate_pin! method:</h4>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">generate_pin!</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">update_column</span><span class="p">(</span><span class="ss">:pin</span><span class="p">,</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span><span class="mi">6</span><span class="p">))</span> <span class="c1">#generate a random six digit number</span>
  <span class="k">end</span></code></pre></div>

<h4>8. Skip the send pin to twilio part for now</h4>

<h4>9. Show pin form for the user input:</h4>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1">#routes.rb:</span>
<span class="n">get</span> <span class="s1">&#39;/pin&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">&#39;sessions#pin&#39;</span>
<span class="n">post</span> <span class="s1">&#39;/pin&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">&#39;sessions#pin&#39;</span></code></pre></div>

<h4>10. Adding the above routes, gives us the pin_path route which we can redirect to:</h4>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">create</span>
  <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">username</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:username</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
  <span class="k">if</span> <span class="n">user</span> <span class="o">&amp;&amp;</span> <span class="n">user</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:password</span><span class="o">]</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">two_factor_auth?</span>
      <span class="c1">#generate a pin</span>
      <span class="n">user</span><span class="o">.</span><span class="n">generate_pin!</span>
      <span class="c1">#send pin to twilio, sms user&#39;s phone</span>

      <span class="c1">#show pin form for user input after sms</span>
      <span class="n">redirect_to</span> <span class="n">pin_path</span>

    <span class="k">else</span>
      <span class="n">session</span><span class="o">[</span><span class="ss">:user_id</span><span class="o">]</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span>
      <span class="n">flash</span><span class="o">[</span><span class="ss">:notice</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;Welcome, you&#39;ve logged in.&quot;</span>
      <span class="n">redirect_to</span> <span class="n">root_path</span>
    <span class="k">end</span>
  <span class="k">else</span>
    <span class="n">flash</span><span class="o">[</span><span class="ss">:error</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;There is something with your username &amp; password.&quot;</span>
    <span class="n">redirect_to</span> <span class="n">login_path</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<h4>11. Now create a pin.html.erb file under views</h4>

<h4>12. Now when attempting to go to the get &#39;/pin&#39; upon being redirected to the pin_path,</h4>

<p>notice that the get method work without even creating the action. ** When there is a link,
the default is to render. This will not work when the method post is called bc you are inputing
parameters:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1">#sessions_controller.rb</span>
<span class="k">def</span> <span class="nf">pin</span>
  <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">post?</span>
    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_by</span><span class="p">(</span><span class="ss">pin</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:pin</span><span class="o">]</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">user</span>
      <span class="c1">#remove pin</span>
      <span class="n">user</span><span class="o">.</span><span class="n">remove_pin!</span>
      <span class="c1">#normal login success route</span>
      <span class="n">login_user!</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="n">flash</span><span class="o">[</span><span class="ss">:error</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;Sorry, something is wrong with the pin you&#39;ve entered.&quot;</span>
      <span class="n">redirect_to</span> <span class="n">pin_path</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="kp">private</span>

<span class="k">def</span> <span class="nf">login_user!</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
  <span class="n">session</span><span class="o">[</span><span class="ss">:user_id</span><span class="o">]</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span>
  <span class="n">flash</span><span class="o">[</span><span class="ss">:notice</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;Welcome, you&#39;ve logged in.&quot;</span>
  <span class="n">redirect_to</span> <span class="n">root_path</span>
<span class="k">end</span></code></pre></div>

<h4>13. Now we must set prevent users from going to the &#39;/pin&#39; url by entering it</h4>

<p>in their browser:
We can do so by setting a session hash to true/false after login attempt/sucessful login
in the sessions_controller:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1">#sessions_controller.rb</span>

<span class="c1">#login attempt</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">username</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:username</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
    <span class="k">if</span> <span class="n">user</span> <span class="o">&amp;&amp;</span> <span class="n">user</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:password</span><span class="o">]</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">two_factor_auth?</span>
        <span class="n">session</span><span class="o">[</span><span class="ss">:two_factor</span><span class="o">]</span> <span class="o">=</span> <span class="kp">true</span>
<span class="c1">#successful login</span>
<span class="k">def</span> <span class="nf">pin</span>
  <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">post?</span>
    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_by</span><span class="p">(</span><span class="ss">pin</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:pin</span><span class="o">]</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">user</span>
      <span class="n">session</span><span class="o">[</span><span class="ss">:two_factor</span><span class="o">]</span> <span class="o">=</span> <span class="kp">nil</span>
      <span class="c1">#remove pin</span>
      <span class="o">.</span>
      <span class="o">.</span>
      <span class="o">.</span></code></pre></div>

<h4>14. Now we can lock down the url using our access_denied method we previously created:</h4>

<p>We can put this in the session#pin bc it impacts both the get and post</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1">#sessions_controller.rb</span>

<span class="k">def</span> <span class="nf">pin</span>
  <span class="n">access_denied</span> <span class="k">if</span> <span class="n">session</span><span class="o">[</span><span class="ss">:two_factor</span><span class="o">].</span><span class="n">nil?</span>
  <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">post?</span>
    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_by</span><span class="p">(</span><span class="ss">pin</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:pin</span><span class="o">]</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">user</span>
      <span class="n">session</span><span class="o">[</span><span class="ss">:two_factor</span><span class="o">]</span> <span class="o">=</span> <span class="kp">nil</span>
      <span class="c1">#remove pin</span>
      <span class="n">user</span><span class="o">.</span><span class="n">remove_pin!</span>
      <span class="c1">#normal login success route</span>
      <span class="n">login_user!</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="n">flash</span><span class="o">[</span><span class="ss">:error</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;Sorry, something is wrong with the pin you&#39;ve entered.&quot;</span>
      <span class="n">redirect_to</span> <span class="n">pin_path</span>
    <span class="k">end</span></code></pre></div>

<h4>15. remove.pin! method</h4>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1">#user.rb</span>
<span class="k">def</span> <span class="nf">remove_pin!</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">update_column</span><span class="p">(</span><span class="ss">:pin</span><span class="p">,</span> <span class="kp">nil</span><span class="p">)</span>
<span class="k">end</span></code></pre></div>

<h4>16. Now its time to intergrate Twilio</h4>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">-</span> <span class="n">install</span> <span class="n">the</span> <span class="no">Twilio</span><span class="o">-</span><span class="no">Ruby</span> <span class="n">gem</span></code></pre></div>

<h4>17. Create a method to send to text to user using Twilio api</h4>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1">#sessions_controller.rb</span>
<span class="k">def</span> <span class="nf">create</span>
  <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">username</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:username</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
  <span class="k">if</span> <span class="n">user</span> <span class="o">&amp;&amp;</span> <span class="n">user</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:password</span><span class="o">]</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">two_factor_auth?</span>
      <span class="n">session</span><span class="o">[</span><span class="ss">:two_factor</span><span class="o">]</span> <span class="o">=</span> <span class="kp">true</span>
      <span class="c1">#generate a pin</span>
      <span class="n">user</span><span class="o">.</span><span class="n">generate_pin!</span>
      <span class="c1">#send pin to twilio, sms user&#39;s phone</span>
      <span class="n">user</span><span class="o">.</span><span class="n">send_pin_to_twilio</span>
      <span class="c1">#show pin form for user input after sms</span>
      <span class="n">redirect_to</span> <span class="n">pin_path</span></code></pre></div>

<h4>18. Create send<em>pin</em>to_twilio method in user.rb (using Twilio two factor authentication)</h4>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">send_pin_to_twilio</span>
  <span class="n">account_sid</span> <span class="o">=</span><span class="s1">&#39;AC47bdb7f569ae31aa59309f81981aaf37&#39;</span>
  <span class="n">auth_token</span> <span class="o">=</span> <span class="s1">&#39;f3d9c378bba9272d3ed9fec659e353b0&#39;</span>

  <span class="c1"># set up a client to talk to the Twilio REST API</span>
  <span class="n">client</span> <span class="o">=</span> <span class="no">Twilio</span><span class="o">::</span><span class="no">REST</span><span class="o">::</span><span class="no">Client</span><span class="o">.</span><span class="n">new</span> <span class="n">account_sid</span><span class="p">,</span> <span class="n">auth_token</span>
  <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Hello, Please enter this pin to continue login: </span><span class="si">#{</span><span class="nb">self</span><span class="o">.</span><span class="n">pin</span><span class="si">}</span><span class="s2">.&quot;</span>
  <span class="n">account</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">account</span>
  <span class="n">message</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">sms</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
    <span class="ss">:from</span> <span class="o">=&gt;</span> <span class="s1">&#39;123-456-789&#39;</span><span class="p">,</span>
    <span class="ss">:to</span> <span class="o">=&gt;</span> <span class="s1">&#39;123-456-789&#39;</span><span class="p">,</span>
    <span class="ss">:body</span> <span class="o">=&gt;</span> <span class="n">msg</span><span class="p">,</span>
    <span class="p">})</span>
  <span class="k">end</span></code></pre></div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/11/20/course2-metapro-concerns/">
        Rapid Prototyping with Rails: Lesson 4, Comparing Metaprogramming vs. Concerns
      </a>
    </h1>

    <span class="post-date">20 Nov 2014</span>

    <h2>There are two options for Extracting Common code:</h2>

<ul>
<li>Metaprogramming</li>
<li>Modules/Concerns</li>
</ul>

<h2>Closer look at Metaprogramming</h2>

<p>Metaprogamming will allow you to include a module that will allow your Instance/Class methods to run as class/instance methods:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">Votetable</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">included</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
    <span class="n">base</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="ss">:include</span><span class="p">,</span> <span class="no">InstanceMethods</span><span class="p">)</span>
    <span class="n">base</span><span class="o">.</span><span class="n">extend</span> <span class="no">ClassMethods</span>
  <span class="k">end</span></code></pre></div>

<h3>So for class methods:</h3>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">Votetable</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">included</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
    <span class="n">base</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="ss">:include</span><span class="p">,</span> <span class="no">InstanceMethods</span><span class="p">)</span>
    <span class="n">base</span><span class="o">.</span><span class="n">extend</span> <span class="no">ClassMethods</span>
    <span class="n">base</span><span class="o">.</span><span class="n">class_eval</span> <span class="k">do</span>
      <span class="n">my_class_eval</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="nc">InstanceMethods</span>
    <span class="k">def</span> <span class="nf">total_votes</span>
      <span class="nb">self</span><span class="o">.</span><span class="n">up_votes</span> <span class="o">-</span> <span class="nb">self</span><span class="o">.</span><span class="n">down_votes</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">up_votes</span>
      <span class="nb">self</span><span class="o">.</span><span class="n">votes</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">vote</span><span class="p">:</span> <span class="kp">true</span><span class="p">)</span><span class="o">.</span><span class="n">size</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">down_votes</span>
      <span class="nb">self</span><span class="o">.</span><span class="n">votes</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">vote</span><span class="p">:</span> <span class="kp">false</span><span class="p">)</span><span class="o">.</span><span class="n">size</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="nc">ClassMethods</span>
    <span class="k">def</span> <span class="nf">my_class_method</span>
      <span class="nb">puts</span> <span class="s2">&quot;This is class method&quot;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>One thing to understand is that you can organize the code below into a sub-module to orchestrate how the code is called:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">Votetable</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">included</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
    <span class="n">base</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="ss">:include</span><span class="p">,</span> <span class="no">InstanceMethods</span><span class="p">)</span>
    <span class="n">base</span><span class="o">.</span><span class="n">extend</span> <span class="no">ClassMethods</span>
    <span class="n">base</span><span class="o">.</span><span class="n">class_eval</span> <span class="k">do</span> <span class="c1">#calling the class method each time the Post class is called</span>
      <span class="n">my_class_eval</span>
    <span class="k">end</span>
  <span class="k">end</span></code></pre></div>

<p>So if you went into rails console and called Post =&gt; &quot;This is class method&quot; would load, in addition to the Post object.</p>

<h2>Closer look at ActiveSupport::Concerns (Modules)</h2>

<p>We can also extract our has_many :votes, as: :voteble association, but we can place this in a class method, which will allow it to be fired automatically when the Post class is called
 just as though its in the model:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">ClassMethods</span>
     <span class="n">has_many</span> <span class="ss">:votes</span><span class="p">,</span> <span class="ss">as</span><span class="p">:</span> <span class="ss">:voteable</span>
   <span class="k">end</span></code></pre></div>

<h3>Using Concerns</h3>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">Voteable</span>
     <span class="kp">extend</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Concern</span>

     <span class="n">included</span> <span class="k">do</span>
       <span class="n">has_many</span> <span class="ss">:votes</span><span class="p">,</span> <span class="ss">as</span><span class="p">:</span> <span class="ss">:voteable</span>
     <span class="k">end</span>


     <span class="k">def</span> <span class="nf">total_votes</span>
       <span class="nb">self</span><span class="o">.</span><span class="n">up_votes</span> <span class="o">-</span> <span class="nb">self</span><span class="o">.</span><span class="n">down_votes</span>
     <span class="k">end</span>

     <span class="k">def</span> <span class="nf">up_votes</span>
       <span class="nb">self</span><span class="o">.</span><span class="n">votes</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">vote</span><span class="p">:</span> <span class="kp">true</span><span class="p">)</span><span class="o">.</span><span class="n">size</span>
     <span class="k">end</span>

     <span class="k">def</span> <span class="nf">down_votes</span>
       <span class="nb">self</span><span class="o">.</span><span class="n">votes</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">vote</span><span class="p">:</span> <span class="kp">false</span><span class="p">)</span><span class="o">.</span><span class="n">size</span>
     <span class="k">end</span>
   <span class="k">end</span></code></pre></div>

<h3>Using Metaprogramming</h3>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">Voteable</span>
     <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">included</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
       <span class="n">base</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="ss">:include</span><span class="p">,</span> <span class="no">InstanceMethods</span><span class="p">)</span>
       <span class="n">base</span><span class="o">.</span><span class="n">extend</span> <span class="no">ClassMethods</span>
     <span class="k">end</span>

     <span class="k">class</span> <span class="nc">InstanceMethods</span>

       <span class="k">def</span> <span class="nf">total_votes</span>
         <span class="nb">self</span><span class="o">.</span><span class="n">up_votes</span> <span class="o">-</span> <span class="nb">self</span><span class="o">.</span><span class="n">down_votes</span>
       <span class="k">end</span>

       <span class="k">def</span> <span class="nf">up_votes</span>
         <span class="nb">self</span><span class="o">.</span><span class="n">votes</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">vote</span><span class="p">:</span> <span class="kp">true</span><span class="p">)</span><span class="o">.</span><span class="n">size</span>
       <span class="k">end</span>

       <span class="k">def</span> <span class="nf">down_votes</span>
         <span class="nb">self</span><span class="o">.</span><span class="n">votes</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">vote</span><span class="p">:</span> <span class="kp">false</span><span class="p">)</span><span class="o">.</span><span class="n">size</span>
       <span class="k">end</span>
     <span class="k">end</span>

     <span class="k">class</span> <span class="nc">ClassMethods</span>
       <span class="n">has_many</span> <span class="ss">:votes</span><span class="p">,</span> <span class="ss">as</span><span class="p">:</span> <span class="ss">:voteable</span>
     <span class="k">end</span>
   <span class="k">end</span></code></pre></div>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page17">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page15">Newer</a>
    
  
</div>
    </div>

  </body>
</html>
