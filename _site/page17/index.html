<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      grit| commit &middot; A coding blog by Jam
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-0c">

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          <span style="color: #FF6347; font: Verdana">grit| commit</span>
        </a>
      </h1>
      <p class="lead">daily learnings as a ruby dev</p>
    </div>



    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>

      

      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href=""></a>

            <a class="sidebar-nav-item" href="/about/">About</a>

          
        
      
        
          
            <a class="sidebar-nav-item" href=""></a>

            <a class="sidebar-nav-item" href="/archive/">Archive</a>

          
        
      
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      

    <p>&copy; 2015. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/10/20/nested-routes/">
        Rapid Prototyping with Rails: Lesson 2, Nested Routes
      </a>
    </h1>

    <span class="post-date">20 Oct 2014</span>

    <p>Comments - using Nested Routes</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:post_id</span><span class="o">]</span><span class="p">)</span>
    <span class="vi">@comment</span> <span class="o">=</span> <span class="no">Comment</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:comment</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:body</span><span class="p">))</span>
    <span class="vi">@comment</span><span class="o">.</span><span class="n">post</span> <span class="o">=</span> <span class="vi">@post</span>
  <span class="k">end</span></code></pre></div>

<p>OR</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:post_id</span><span class="o">]</span><span class="p">)</span>
    <span class="vi">@comment</span> <span class="o">=</span> <span class="vi">@post</span><span class="o">.</span><span class="n">comments</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:comment</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:body</span><span class="p">))</span>
  <span class="k">end</span></code></pre></div>

<p>What we&#39;ve covered:</p>

<ol>
<li><p>Creating a Nested Resource</p></li>
<li><p>Creating a model-backed form in a nested resource way... to generate a nested URL</p></li>
<li><p>In your controller Create action, you must set up the parent object in the controller action, so that it can be called on in your form_for</p></li>
<li><p>Under the error condition, you have to render &#39;posts/show&#39; rather than &#39;new&#39;</p></li>
</ol>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/10/17/model-backed-forms/">
        Rapid Prototyping with Rails: Lesson 2, Walk-through (model-backed forms)
      </a>
    </h1>

    <span class="post-date">17 Oct 2014</span>

    <h2>Rails Model Backed Forms - Create a Resource called: Dog</h2>

<p>Command to change port: rails s -p 3001</p>

<ol>
<li>Run migration</li>
</ol>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">rails</span> <span class="n">g</span> <span class="n">create_dogs</span>

    <span class="k">class</span> <span class="nc">CreateDogs</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
      <span class="k">def</span> <span class="nf">change</span>
        <span class="n">create_table</span> <span class="ss">:dogs</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
          <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:name</span>
          <span class="n">t</span><span class="o">.</span><span class="n">integer</span> <span class="ss">:height_in_inches</span><span class="p">,</span> <span class="ss">:weight_in_lbs</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span></code></pre></div>

<ol>
<li>Create dog.rb under Models</li>
</ol>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Dogs</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
<span class="k">end</span></code></pre></div>

<ol>
<li><p>rake db:migrate or bundle exec rake:db migrate</p></li>
<li><p>Hop into Rails Console to add instances of Dog class</p></li>
<li><p>Create Resources or Routes manually</p></li>
</ol>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="mi">1</span><span class="o">.</span> <span class="no">Create</span> <span class="no">Using</span> <span class="no">Resources</span>
    <span class="n">resources</span> <span class="ss">:dogs</span><span class="p">,</span> <span class="n">except</span> <span class="o">[</span><span class="ss">:destroy</span><span class="o">]</span>
<span class="mi">2</span><span class="o">.</span> <span class="no">Write</span> <span class="n">routes</span> <span class="n">manually</span> <span class="k">in</span> <span class="n">routes</span> <span class="n">file</span>
    <span class="n">get</span> <span class="s1">&#39;/dogs/&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">&#39;dogs#index&#39;</span>
    <span class="n">get</span> <span class="s1">&#39;/dogs/:id&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">&#39;dogs#show&#39;</span>
    <span class="n">get</span> <span class="s1">&#39;dogs/new&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">&#39;dogs#new&#39;</span>
    <span class="n">post</span> <span class="s1">&#39;/dogs&#39;</span><span class="p">,</span>   <span class="ss">to</span><span class="p">:</span> <span class="s1">&#39;dogs#create&#39;</span>
    <span class="n">get</span> <span class="s1">&#39;/dogs/:id/edit&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="n">dogs</span><span class="c1">#edit</span>
    <span class="n">patch</span> <span class="s1">&#39;/dogs/:id&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="n">dogs</span><span class="c1">#update</span>
    <span class="n">delete</span>  <span class="s1">&#39;dogs/:id&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="n">dogs</span><span class="c1">#destroy</span></code></pre></div>

<ol>
<li>Create Dogs Controller</li>
</ol>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1">#dogs_controller.rb</span>
<span class="k">class</span> <span class="nc">DogsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<ol>
<li><p>We will get an error because there no index.html.erb under the dogs folders within
the views folder</p></li>
<li><p>Create instance variable to pass into the template</p></li>
</ol>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">index</span>
  <span class="vi">@dogs</span> <span class="o">=</span> <span class="no">Dogs</span><span class="o">.</span><span class="n">all</span>
 <span class="k">end</span></code></pre></div>

<ol>
<li>Better yet, in your model, you could:</li>
</ol>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Dog</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
    <span class="k">def</span> <span class="nf">info</span>
      <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is </span><span class="si">#{</span><span class="nb">self</span><span class="o">.</span><span class="n">height_in_inches</span><span class="si">}</span><span class="s2"> inches tall and weighs </span><span class="si">#{</span><span class="nb">self</span><span class="o">.</span><span class="n">weight_in_lbs</span><span class="si">}</span><span class="s2"> lbs.&quot;</span>
    <span class="k">end</span>
  <span class="k">end</span></code></pre></div>

<p>Something like the above is okay, but not okay to add html to that statement. In no way should you ever add presentational concerns at the model level. Application_helpers is for formatting logic on the user interface</p>

<ol>
<li>A better solution is to add this code to the application_helper.</li>
</ol>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1">#application_helper.rb</span>
    <span class="k">def</span> <span class="nf">dog_info</span><span class="p">(</span><span class="n">dog</span><span class="p">)</span>
      <span class="s2">&quot;</span><span class="si">#{</span><span class="n">dog</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is </span><span class="si">#{</span><span class="n">dog</span><span class="o">.</span><span class="n">height_in_inches</span><span class="si">}</span><span class="s2"> inches tall and weighs </span><span class="si">#{</span><span class="n">dog</span><span class="o">.</span><span class="n">weight_in_lbs</span><span class="si">}</span><span class="s2"> lbs.&quot;</span>
    <span class="k">end</span></code></pre></div>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1">#index.html.erb</span>
    <span class="o">&lt;</span><span class="n">h2</span><span class="o">&gt;</span><span class="no">All</span> <span class="n">the</span> <span class="n">dogs</span> <span class="o">&lt;</span><span class="sr">/h2&gt;</span>

<span class="sr">    &lt;ul&gt;</span>
<span class="sr">    &lt;% @dogs.each do |dog| %&gt;</span>
<span class="sr">      &lt;li&gt;&lt;%= dog_info(dog) %&gt;&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="sx">% end %&gt;</span>
<span class="sx">    &lt;/ul&gt;</span></code></pre></div>

<hr>

<h2>Lets add the new action to the controller:</h2>

<ol>
<li>Add link to navigation bar for a new dog:</li>
</ol>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s1">&#39;nav_item&#39;</span><span class="o">&gt;</span>
    <span class="o">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;New Dog&#39;</span><span class="p">,</span> <span class="n">new_dog_path</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s1">&#39;btn btn-success btn-small&#39;</span> <span class="sx">%&gt;</span>
<span class="sx">  &lt;/div&gt;</span></code></pre></div>

<ol>
<li>Must update routes to include the named route:</li>
</ol>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">get</span> <span class="s1">&#39;/dogs/&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">&#39;dogs#index&#39;</span>
    <span class="n">get</span> <span class="s1">&#39;/dogs/:id&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">&#39;dogs#show&#39;</span>
    <span class="n">get</span> <span class="s1">&#39;dogs/new&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">&#39;dogs#new&#39;</span><span class="p">,</span> <span class="ss">as</span><span class="p">:</span> <span class="s1">&#39;new_dog&#39;</span>
    <span class="n">post</span> <span class="s1">&#39;/dogs&#39;</span><span class="p">,</span>   <span class="ss">to</span><span class="p">:</span> <span class="s1">&#39;dogs#create&#39;</span>
    <span class="n">get</span> <span class="s1">&#39;/dogs/:id/edit&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="n">dogs</span><span class="c1">#edit</span>
    <span class="n">patch</span> <span class="s1">&#39;/dogs/:id&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="n">dogs</span><span class="c1">#update</span>
    <span class="n">delete</span>  <span class="s1">&#39;dogs/:id&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="n">dogs</span><span class="c1">#destroy</span></code></pre></div>

<ol>
<li>You must list routes in proper order - order matters</li>
</ol>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">get</span> <span class="s1">&#39;dogs/new&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">&#39;dogs#new&#39;</span><span class="p">,</span> <span class="ss">as</span><span class="p">:</span> <span class="s1">&#39;new_dog&#39;</span>
    <span class="n">get</span> <span class="s1">&#39;/dogs/&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">&#39;dogs#index&#39;</span> <span class="ss">as</span><span class="p">:</span> <span class="s1">&#39;dogs&#39;</span>
    <span class="n">get</span> <span class="s1">&#39;/dogs/:id&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">&#39;dogs#show&#39;</span>  <span class="ss">as</span><span class="p">:</span> <span class="s1">&#39;dog&#39;</span>
    <span class="n">post</span> <span class="s1">&#39;/dogs&#39;</span><span class="p">,</span>   <span class="ss">to</span><span class="p">:</span> <span class="s1">&#39;dogs#create&#39;</span>
    <span class="n">get</span> <span class="s1">&#39;/dogs/:id/edit&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="n">dogs</span><span class="c1">#edit</span>
    <span class="n">patch</span> <span class="s1">&#39;/dogs/:id&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="n">dogs</span><span class="c1">#update</span>
    <span class="n">delete</span>  <span class="s1">&#39;dogs/:id&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="n">dogs</span><span class="c1">#destroy</span></code></pre></div>

<ol>
<li>Create</li>
</ol>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1">#new.html.erb</span>
    <span class="o">&lt;</span><span class="n">h4</span><span class="o">&gt;</span> <span class="no">Create</span> <span class="n">a</span> <span class="kp">new</span> <span class="n">dog</span> <span class="o">&lt;</span><span class="sr">/h4&gt;</span>

<span class="sr">    &lt;%= form_for @dog do |f| %&gt;</span>
<span class="sr">      &lt;%= f.label :name %&gt;</span>
<span class="sr">      &lt;%= f.text_field :name %&gt;</span>
<span class="sr">      &lt;br/</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="sx">%= f.label :weight %&gt;</span>
<span class="sx">      &lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_field</span> <span class="ss">:weight_in_inches</span> <span class="sx">%&gt;</span>
<span class="sx">      &lt;br/&gt;</span>
      <span class="o">&lt;</span><span class="sx">%= f.label :height %&gt;</span>
<span class="sx">      &lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_field</span> <span class="ss">:height_in_inches</span> <span class="sx">%&gt;</span>
<span class="sx">      &lt;/br&gt;</span>
      <span class="o">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="s2">&quot;Create dog&quot;</span> <span class="sx">%&gt;</span>

<span class="sx">    &lt;% end %&gt;</span></code></pre></div>

<h2>Create</h2>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">create</span>

  <span class="vi">@dog</span> <span class="o">=</span> <span class="no">Dog</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:dog</span><span class="p">)</span><span class="o">.</span><span class="n">permit!</span><span class="p">)</span>

    <span class="k">if</span> <span class="vi">@dog</span><span class="o">.</span><span class="n">save</span>
      <span class="n">flash</span><span class="o">[</span><span class="ss">:notice</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;You created a dog!&quot;</span>
      <span class="n">redirect_to</span> <span class="n">dogs_path</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:new</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>Render can take a string or a method. Form_for looks at @post  and determines are you a new post or are you an existing post. If it is in a existing object, then the _method is injected to execute a patch, rather than post.  Params is a nested hash.</p>

<h2>Edit</h2>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1">#dogs_controller.rb</span>
<span class="k">def</span> <span class="nf">edit</span>
  <span class="vi">@dog</span> <span class="o">=</span> <span class="no">Dog</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
<span class="k">end</span></code></pre></div>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">edit</span><span class="o">.</span><span class="n">hmtl</span><span class="o">.</span><span class="n">erb</span>

    <span class="o">&lt;</span><span class="n">h4</span><span class="o">&gt;</span> <span class="no">Create</span> <span class="n">a</span> <span class="kp">new</span> <span class="n">dog</span> <span class="o">&lt;</span><span class="sr">/h4&gt;</span>

<span class="sr">    &lt;%= form_for @dog do |f| %&gt;</span>
<span class="sr">      &lt;%= f.label :name %&gt;</span>
<span class="sr">      &lt;%= f.text_field :name %&gt;</span>
<span class="sr">      &lt;br/</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="sx">%= f.label :weight %&gt;</span>
<span class="sx">      &lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_field</span> <span class="ss">:weight_in_inches</span> <span class="sx">%&gt;</span>
<span class="sx">      &lt;br/&gt;</span>
      <span class="o">&lt;</span><span class="sx">%= f.label :height %&gt;</span>
<span class="sx">      &lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_field</span> <span class="ss">:height_in_inches</span> <span class="sx">%&gt;</span>
<span class="sx">      &lt;/br&gt;</span>
      <span class="o">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="s2">&quot;Create dog&quot;</span> <span class="sx">%&gt;</span>
<span class="sx">    &lt;% end %&gt;</span></code></pre></div>

<h2>Update</h2>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">update</span>
<span class="vi">@dog</span> <span class="o">=</span> <span class="no">Dog</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>

    <span class="k">if</span> <span class="vi">@dog</span><span class="o">.</span><span class="n">update?</span>
      <span class="n">flash</span><span class="o">[</span><span class="ss">:notice</span><span class="o">]</span> <span class="o">=</span> <span class="no">Your</span> <span class="n">dog</span> <span class="n">has</span> <span class="n">been</span> <span class="n">updated!</span>
      <span class="n">redirect_to</span> <span class="n">dogs_path</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:edit</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<h2>Resources</h2>

<p>So all the routes from below:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">get</span> <span class="s1">&#39;dogs/new&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">&#39;dogs#new&#39;</span><span class="p">,</span> <span class="ss">as</span><span class="p">:</span> <span class="s1">&#39;new_dog&#39;</span>
    <span class="n">get</span> <span class="s1">&#39;/dogs/&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">&#39;dogs#index&#39;</span> <span class="ss">as</span><span class="p">:</span> <span class="s1">&#39;dogs&#39;</span>
    <span class="n">get</span> <span class="s1">&#39;/dogs/:id&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">&#39;dogs#show&#39;</span>  <span class="ss">as</span><span class="p">:</span> <span class="s1">&#39;dog&#39;</span>
    <span class="n">post</span> <span class="s1">&#39;/dogs&#39;</span><span class="p">,</span>   <span class="ss">to</span><span class="p">:</span> <span class="s1">&#39;dogs#create&#39;</span>
    <span class="n">get</span> <span class="s1">&#39;/dogs/:id/edit&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="n">dogs</span><span class="c1">#edit</span>
    <span class="n">patch</span> <span class="s1">&#39;/dogs/:id&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="n">dogs</span><span class="c1">#update</span>
    <span class="n">delete</span>  <span class="s1">&#39;dogs/:id&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="n">dogs</span><span class="c1">#destroy</span></code></pre></div>

<p>Can be replaced with resources :dogs</p>

<h2>Add an edit link to the index page:</h2>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">index</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">erb</span>
    <span class="o">&lt;</span><span class="n">h2</span><span class="o">&gt;</span><span class="no">All</span> <span class="n">the</span> <span class="n">dogs</span> <span class="o">&lt;</span><span class="sr">/h2&gt;</span>

<span class="sr">    &lt;ul&gt;</span>
<span class="sr">    &lt;% @dogs.each do |dog| %&gt;</span>
<span class="sr">      &lt;li&gt;&lt;%= dog_info(dog) %&gt;&lt;/</span><span class="n">li</span><span class="o">&gt;&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;[edit]&#39;</span><span class="p">,</span> <span class="n">edit_dog_path</span><span class="p">(</span><span class="n">dog</span><span class="p">)</span><span class="sx">%&gt;&lt;/li&gt;</span>
    <span class="o">&lt;</span><span class="sx">% end %&gt;</span>
<span class="sx">    &lt;/ul&gt;</span></code></pre></div>

<h2>Extract common code from new and edit forms into partial:</h2>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">_form</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">erb</span>
    <span class="o">&lt;</span><span class="sx">%= form_for @dog do |f| %&gt;</span>
<span class="sx">      &lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:name</span> <span class="sx">%&gt;</span>
<span class="sx">      &lt;%= f.text_field :name %&gt;</span>
      <span class="o">&lt;</span><span class="n">br</span><span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="sx">%= f.label :weight %&gt;</span>
<span class="sx">      &lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_field</span> <span class="ss">:weight_in_inches</span> <span class="sx">%&gt;</span>
<span class="sx">      &lt;br/&gt;</span>
      <span class="o">&lt;</span><span class="sx">%= f.label :height %&gt;</span>
<span class="sx">      &lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_field</span> <span class="ss">:height_in_inches</span> <span class="sx">%&gt;</span>
<span class="sx">      &lt;/br&gt;</span>
      <span class="o">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="vi">@dog</span><span class="o">.</span><span class="n">new_record?</span> <span class="p">?</span> <span class="s1">&#39;Create&#39;</span> <span class="p">:</span> <span class="s1">&#39;Update&#39;</span><span class="si">}</span><span class="s2">dog&quot;</span> <span class="o">%&gt;</span></code></pre></div>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="kp">new</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">erb</span>
<span class="o">&lt;</span><span class="n">h4</span><span class="o">&gt;</span> <span class="no">Create</span> <span class="n">a</span> <span class="no">Dog</span> <span class="o">&lt;</span><span class="sr">/h4&gt;</span>
<span class="sr">&lt;%= render &#39;form&#39; %&gt;</span></code></pre></div>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">edit</span><span class="o">.</span><span class="n">hmtl</span><span class="o">.</span><span class="n">erb</span>
<span class="o">&lt;</span><span class="n">h4</span><span class="o">&gt;</span> <span class="no">Edit</span> <span class="n">a</span> <span class="no">Dog</span> <span class="o">&lt;</span><span class="sr">/h4&gt;</span>
<span class="sr">&lt;%= render &#39;form&#39; %&gt;</span></code></pre></div>

<h2>Validations</h2>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">dog</span><span class="o">.</span><span class="n">rb</span>
<span class="n">validates</span> <span class="ss">:name</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span>
<span class="n">validates</span> <span class="ss">:height_in_inches</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span>
<span class="n">validates</span> <span class="ss">:weight_in_lbs</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span></code></pre></div>

<h2>rails console</h2>

<p>Failure to satisfy strong_paramters will generate errors. There are several methods
we can call regarding errors in our rails console</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">dog</span> <span class="o">=</span> <span class="no">Dog</span><span class="o">.</span><span class="n">new</span><span class="p">(),</span> <span class="k">then</span> <span class="n">dog</span><span class="o">.</span><span class="n">save</span> <span class="n">will</span> <span class="n">generate</span> <span class="n">the</span> <span class="n">errors</span> <span class="n">array</span> <span class="n">on</span> <span class="n">the</span> <span class="n">object</span> <span class="n">itself</span>

  <span class="mi">1</span><span class="o">.</span> <span class="n">dog</span><span class="o">.</span><span class="n">errors</span> <span class="c1">#will list errors</span>
  <span class="mi">2</span><span class="o">.</span> <span class="n">dog</span><span class="o">.</span><span class="n">valid?</span> <span class="c1"># will be false because there were errors</span>
  <span class="mi">3</span><span class="o">.</span> <span class="n">dog</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">empty?</span> <span class="c1">#false</span>
  <span class="mi">4</span><span class="o">.</span> <span class="n">dog</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">full_messages</span> <span class="c1">#will display an array of current error messages that you can use to display on the user interface</span></code></pre></div>

<h2>Display errors in _form.html.erb</h2>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">_form</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">erb</span>
  <span class="o">&lt;</span><span class="sx">% if </span><span class="vi">@dog</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">any?</span> <span class="sx">%&gt;</span>
<span class="sx">  Please correct the following errors:</span>

<span class="sx">  &lt;ul&gt;</span>
    <span class="o">&lt;</span><span class="sx">% @dog.errors.full_messages.each </span><span class="k">do</span> <span class="o">|</span><span class="n">msg</span><span class="o">|</span>
    <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;&lt;</span><span class="sx">%= msg %&gt;&lt;/li&gt;</span>
<span class="sx">    &lt;% end %&gt;</span>
<span class="sx">    &lt;/ul&gt;</span>
<span class="sx">  &lt;% end %&gt;</span>

<span class="sx">&lt;%=</span> <span class="n">form_for</span> <span class="vi">@dog</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="sx">%&gt;</span>
<span class="sx">  &lt;%= f.label :name %&gt;</span>
  <span class="o">&lt;</span><span class="sx">%= f.text_field :name %&gt;</span>
<span class="sx">  &lt;br/&gt;</span>
<span class="sx">  &lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:weight</span> <span class="sx">%&gt;</span>
<span class="sx">  &lt;%= f.text_field :weight_in_inches %&gt;</span>
  <span class="o">&lt;</span><span class="n">br</span><span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="sx">%= f.label :height %&gt;</span>
<span class="sx">  &lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_field</span> <span class="ss">:height_in_inches</span> <span class="sx">%&gt;</span>
<span class="sx">  &lt;/br&gt;</span>
 <span class="o">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="vi">@dog</span><span class="o">.</span><span class="n">new_record?</span> <span class="p">?</span> <span class="s1">&#39;Create&#39;</span> <span class="p">:</span> <span class="s1">&#39;Update&#39;</span><span class="si">}</span><span class="s2">dog&quot;</span> <span class="o">%&gt;</span></code></pre></div>

<h2>Field with errors</h2>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">When</span> <span class="n">an</span> <span class="s1">&#39;form_for&#39;</span> <span class="n">is</span> <span class="n">submitted</span> <span class="n">with</span> <span class="n">errors</span><span class="p">,</span> <span class="n">automatically</span> <span class="n">insert</span> <span class="n">a</span> <span class="n">div</span> <span class="n">called</span> <span class="s1">&#39;field_with_errors&#39;</span> <span class="n">around</span> <span class="n">those</span> <span class="n">fields</span> <span class="n">with</span> <span class="n">errors</span> <span class="n">to</span> <span class="n">allow</span> <span class="k">for</span> <span class="n">styling</span><span class="o">.</span> <span class="no">This</span> <span class="n">will</span> <span class="n">also</span> <span class="n">cause</span> <span class="n">the</span> <span class="n">form</span> <span class="n">fields</span> <span class="n">to</span> <span class="n">appear</span> <span class="n">wider</span> <span class="n">apart</span> <span class="p">(</span><span class="n">padding</span><span class="p">)</span></code></pre></div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/10/15/course2-migrations/">
        Rapid Prototyping with Rails: Lesson 2, Migrations
      </a>
    </h1>

    <span class="post-date">15 Oct 2014</span>

    <h1>Items Covered:</h1>

<ol>
<li>Changes to Schema</li>
<li>data definition statements vs query statements</li>
<li>setting up db and creating migration</li>
<li>rolling back

<ul>
<li>up/down methods</li>
</ul></li>
<li>How does Rails keep track of migrations we have run</li>
<li>When to modify a migration</li>
<li>What happens if I can&#39;t run migrations cleanly from end to end</li>
</ol>

<h2>Data Definitions</h2>

<p>Data Definitions are to databases what metaprogramming is to code.
* statement that alter the database rather than query statements that manipulate the
data within a database
* the steup commands before we can even query the database
* statements that alter the metadata and schema
* these occur outside of the code (kinda like setting up the spreadsheet before entering data)
* migrations are a good example of this</p>

<h2>Migrations</h2>

<p>We never want to push our database to other developers when working on a team,
we want to push our schema however, and this is done in the form of migrations.
- by default, all sqlite3 files under db will be ignored when pushing to git, as per gitignore
- To list rake commands pertaining to db:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">rake</span> <span class="o">-</span><span class="n">T</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">db</span></code></pre></div>

<h2>Database Schema Migrations</h2>

<ul>
<li>There is table called schema_migrations which stores the migrations of all currently within
your database</li>
<li>rake db:rollback will roll back you most recently ran</li>
</ul>

<h2>Rollbacks</h2>

<p><strong>Have you pushed the migration to github... have you shared locally?</strong>
If not, then rollback is fine, if not.. don&#39;t. Because rollback will not create a diff file name.
The code changed and its fine on your end.. but for your team members, since the filename hasn&#39;t
changed, it will cause their application to blow-up since their migration did not re-run. Instead,
create a new migration such as rails g migration rename_users. Always google, &quot;rails migrations methods&quot;</p>

<p><strong>What happens if applications can&#39;t run cleanly from end-to-end?</strong>
One of the first thing your team-members will do is run rake db:migrate when cloning your projectand migrations that don&#39;t run smoothly is a red flag.
Schema.rb
- can also be loaded when your migrations don&#39;t run from to end-to-end.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">=&gt;</span> <span class="n">rake</span> <span class="ss">db</span><span class="p">:</span><span class="ss">schema</span><span class="p">:</span><span class="nb">load</span></code></pre></div>

<ul>
<li>you can search for available commands using</li>
</ul>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">=&gt;</span> <span class="n">rake</span> <span class="o">-</span><span class="n">T</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">schema</span></code></pre></div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/10/10/course2-lesson2/">
        Rapid Prototyping with Rails: Lesson 2, part 3
      </a>
    </h1>

    <span class="post-date">10 Oct 2014</span>

    <h1>Items covered:</h1>

<ol>
<li>Nested Resources</li>
<li>Helpers</li>
<li>Fat Models, Thin Controllers</li>
<li>Drop-downs</li>
<li>Application Helpers</li>
</ol>

<p>Review nested resource
Setting up categories association in post form</p>

<ol>
<li>How to create a comment in the show posts page.</li>
</ol>

<p>1.1 We need to know how the route to submit to:
* rake routes | grep comments (console)</p>

<p>or</p>

<ul>
<li>localhost:3000/rails/info/routes (browser)</li>
</ul>

<p>1.2 How do we tell our model backed form to submit to the POST create comments action?</p>

<p>By adding @comments to our model backed form_for POST create posts:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">show</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">erb</span>
  <span class="o">&lt;</span><span class="n">h5</span><span class="o">&gt;</span><span class="no">Create</span> <span class="n">a</span> <span class="no">Comment</span> <span class="o">&lt;</span><span class="sr">/h5&gt;</span>
<span class="sr">  &lt;%= form_for [@post, @comment] do |f| #[parent obj, child obj] to create this &#39;posts/i</span><span class="n">d</span><span class="o">/</span><span class="n">comments</span><span class="s1">&#39;</span>
<span class="s1">    &lt;f.text_area :body %&gt;</span>
<span class="s1">      &lt;br/&gt;</span>
<span class="s1">    &lt;%= f.submit &quot;Create Comment&quot;, class: &#39;</span><span class="n">btn</span> <span class="n">btn</span><span class="o">-</span><span class="n">primary</span><span class="err">&#39;</span> <span class="sx">%&gt;</span>
<span class="sx">  &lt;% end %&gt;</span></code></pre></div>

<p>If ever you feel as though you can&#39;t tell which object you are passing through the form_for:
look at the create controller action - there it will tell you where you one which object you are calling
.save on. This is the object that will generate the error if it does not pass validations.</p>

<p>Helpers: What if we wanted to link_to post.url in the show page?</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">show</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">erb</span>

<span class="o">&lt;</span><span class="n">h4</span><span class="o">&gt;</span> <span class="no">Hi</span> <span class="n">there</span><span class="p">,</span> <span class="n">you</span><span class="s1">&#39;re viewing &lt;%= link_to @post.title, @post.url.starts_with?(&#39;</span><span class="ss">http</span><span class="p">:</span><span class="sr">//</span><span class="err">&#39;</span><span class="p">)</span> <span class="p">?</span>
<span class="vi">@post</span><span class="o">.</span><span class="n">url</span> <span class="p">:</span> <span class="s2">&quot;http://</span><span class="si">#{</span><span class="n">post</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;&quot; %&gt;&lt;/h4&gt;</span></code></pre></div>

<h2>Helpers:</h2>

<p>We don&#39;t want our model to be concerned with presentation level concerns.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">application_helper</span><span class="o">.</span><span class="n">rb</span>
    <span class="k">module</span> <span class="nn">ApplicationHelper</span>
      <span class="k">def</span> <span class="nf">fix_url</span>
        <span class="n">str</span><span class="o">.</span><span class="n">starts_with?</span><span class="p">(</span><span class="s1">&#39;http://&#39;</span><span class="p">)</span> <span class="p">?</span> <span class="n">str</span> <span class="p">:</span> <span class="s2">&quot;http://</span><span class="si">#{</span><span class="n">str</span><span class="si">}</span><span class="s2">&quot;</span>
      <span class="k">end</span>
    <span class="k">end</span></code></pre></div>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">show</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">erb</span>
  <span class="o">&lt;</span><span class="n">h4</span><span class="o">&gt;</span><span class="no">Hi</span> <span class="n">there</span><span class="p">,</span> <span class="n">you</span><span class="err">&#39;</span><span class="n">re</span> <span class="n">viewing</span> <span class="o">&lt;%=</span> <span class="n">link_to</span> <span class="n">post</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">fix_url</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="sx">%&gt;&lt;/h4&gt;</span></code></pre></div>

<h2>Fat Models, Thin Controllers</h2>

<p>Move logic to a model method
Problems with logic at the controller level:
1. Sometimes you can&#39;t tell where the input stream is (console, another action)
2. Its really hard to test</p>

<p>**How to associate a post and category in a form?
In order to use the form_for, you must use a getter or setter (colmun name of virtual attribute</p>

<p>In console:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="mi">1</span><span class="o">.</span> <span class="n">post</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">first</span>
  <span class="mi">2</span><span class="o">.</span> <span class="n">post</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">name</span> <span class="o">=&gt;</span> <span class="s2">&quot;Rubyists&quot;</span>
  <span class="mi">3</span><span class="o">.</span> <span class="n">post</span><span class="o">.</span><span class="n">categories</span> <span class="o">=</span> <span class="o">[]</span> <span class="o">=&gt;</span> <span class="no">Delete</span> <span class="n">category</span> <span class="n">associations</span>
  <span class="mi">4</span><span class="o">.</span> <span class="n">post</span><span class="o">.</span><span class="n">category_ids</span> <span class="o">=</span> <span class="o">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">]</span> <span class="o">=&gt;</span> <span class="n">add</span> <span class="n">category_ids</span> <span class="mi">2</span> <span class="ow">and</span> <span class="mi">3</span> <span class="n">to</span> <span class="n">post</span><span class="p">,</span> <span class="n">saves</span> <span class="n">to</span> <span class="n">database</span>
  <span class="mi">5</span><span class="o">.</span> <span class="n">post</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">size</span> <span class="o">=&gt;</span> <span class="mi">2</span>
  <span class="mi">6</span><span class="o">.</span> <span class="n">post</span><span class="o">.</span><span class="n">category_ids</span> <span class="o">=</span> <span class="o">[</span><span class="mi">4</span><span class="o">]</span> <span class="c1"># removes categories previously entered and saves caegory_id 4</span></code></pre></div>

<h2>How to create a drop down</h2>

<p>Learn how to do use Select forms in HTML first:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">*</span><span class="no">Selecting</span> <span class="n">one</span> <span class="ss">option</span><span class="p">:</span>
<span class="o">&lt;</span><span class="nb">select</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">option</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="o">&gt;</span><span class="n">option</span> <span class="mi">1</span><span class="o">&lt;</span><span class="sr">/option&gt;</span>
<span class="sr">  &lt;option value=&#39;2&#39;&gt;option 2&lt;/o</span><span class="n">ption</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="sr">/select&gt;</span>
<span class="sr">** Selecting multiple options</span>
<span class="sr">&lt;select name=&#39;post[category_ids][]&#39; multiple =&#39;multiple&#39;&gt;</span>
<span class="sr">  &lt;option value=&#39;1&#39;&gt;Rubyists&lt;/o</span><span class="n">ption</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">option</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="o">&gt;</span><span class="no">Pythonistas</span><span class="o">&lt;</span><span class="sr">/option&gt;</span>
<span class="sr">&lt;/se</span><span class="n">lect</span><span class="o">&gt;</span></code></pre></div>

<p>But helpers will save in memory your previous selections rather than hard coding
when edit/updating a post.</p>

<p>Note: that name=&#39;post[category_ids]&#39; requires an [] for arrays.</p>

<h3>Strong_params for checkboxes or drop-downs</h3>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">-&gt;</span> <span class="n">category_ids</span> <span class="n">requires</span> <span class="n">an</span> <span class="n">array</span>
    <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:post</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:url</span><span class="p">,</span> <span class="ss">:description</span><span class="p">,</span> <span class="ss">category_ids</span><span class="p">:</span><span class="o">[]</span><span class="p">)</span></code></pre></div>

<h2>Application_helper</h2>

<p>Is were you store redundant, reusable code that shouldn&#39;t be stored at the model layer.
The model should never deal presentation level concerns but rather pure logic, data structures (arrays and hashes).
It should present data in whatever form and the views and helpers should just deal with it
accordingly.
Helpers are good for extracting logic that deals with the view but doesn&#39;t belong to a particular model
or resource.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/10/07/course2-lesson2/">
        Rapid Prototyping with Rails: Lesson 2, part 2
      </a>
    </h1>

    <span class="post-date">07 Oct 2014</span>

    <h1>Topics Covered:</h1>

<ol>
<li>Validation</li>
<li>Errors</li>
<li>General Create Pattern</li>
<li>Update Path</li>
<li>Form Partial</li>
<li>Before_action</li>
<li>Nested Resources</li>
</ol>

<h2>Validations</h2>

<p>are added always at the model layer:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:comments</span>
  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">:presence</span> <span class="kp">true</span>
<span class="k">end</span></code></pre></div>

<p>Now if you go into the rails console and do Post.new without a title, an error will
not occur until you try to hit the database, so either Post.save or Post.create.</p>

<p>When you try to do so, the console will return &quot;False&quot;. This is because, there is
an if clause in the create method. See below. Running post.errors in your console will
print out an array called ActiveModel Errors and will tell you all fields that require
validation... in other words.. can&#39;t be blank.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">create</span>
  <span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">post_params</span><span class="p">)</span>

  <span class="k">if</span> <span class="vi">@post</span><span class="o">.</span><span class="n">save</span>
    <span class="n">flash</span><span class="o">[</span><span class="ss">:notice</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;Your post was created.&quot;</span>
    <span class="n">redirect_to</span> <span class="n">posts_path</span>
  <span class="k">else</span>
    <span class="n">render</span> <span class="s1">&#39;new&#39;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<h2>Errors</h2>

<p>post.errors will generate an array. If you want to parse out the messages...
type post.errors.full_messages</p>

<p>If post.save/post.create is unsuccessful, then you will &#39;render&#39; the new form.
You will &#39;render&#39; and not &#39;redirect&#39; becasue we need to access the errors on the instance
variable in order to display the errors. When the validations arent met and it fails to save,
save, false is returned in the console and the errors array is populated. However, as
it stands, the new form will be rendered.</p>

<p>How to display the Errors (Rails Backed Forms Only)</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">&lt;</span><span class="n">h3</span><span class="o">&gt;</span> <span class="no">Creating</span> <span class="n">a</span> <span class="no">Post</span> <span class="o">&lt;</span><span class="sr">/h3&gt;</span>
<span class="sr">&lt;% if @post.errors.any? %&gt;</span>

<span class="sr">  &lt;h5&gt; There were some errors: &lt;/</span><span class="n">h5</span><span class="o">&gt;</span>

  <span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="sx">% @post.errors.full_messages.each </span><span class="k">do</span> <span class="o">|</span><span class="n">msg</span><span class="o">|</span>
    <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s1">&#39;alert alert-error&#39;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;&lt;</span><span class="sx">% msg %&gt; &lt;/li&gt;</span>
      <span class="o">&lt;</span><span class="sx">% end %&gt;</span>
<span class="sx">    &lt;/div&gt;</span>
  <span class="o">&lt;</span><span class="sr">/ul&gt;</span>
<span class="sr">&lt;% end %&gt;</span></code></pre></div>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">&lt;</span><span class="n">h4</span><span class="o">&gt;</span> <span class="no">Rails</span> <span class="n">model</span><span class="o">-</span><span class="n">backed</span> <span class="n">form</span> <span class="n">helpers</span> <span class="o">&lt;</span><span class="sr">/h4&gt;</span>
<span class="sr">  &lt;%= form_for @post do |f| %&gt; # @post could also be Post.new</span>
<span class="sr">  &lt;%= f.label :title %&gt;</span>
<span class="sr">  &lt;%= f.text_field :title %&gt;</span>

<span class="sr">  &lt;%= f.label :url %&gt;</span>
<span class="sr">  &lt;% f.text_field :title %&gt;</span>
<span class="sr">  &lt;br/</span><span class="o">&gt;</span>
  <span class="o">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="s2">&quot;Create Post&quot;</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s1">&#39;btn btn-primary&#39;</span> <span class="sx">%&gt;</span>
<span class="sx">&lt;% end %&gt;</span></code></pre></div>

<h3>Field with Errors</h3>

<p>Rails creates a div class to allow you to easily point out or style your fields with
errors called &quot;div class = fields with errors&quot;</p>

<p>Form_for does alot of guessing
It guesses that New forms should go to /&#39;posts&#39;</p>

<p>If you:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">&lt;%=</span> <span class="n">form_for</span> <span class="vi">@post</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="o">%&gt;</span> <span class="c1"># @post could also be Post.new</span></code></pre></div>

<p>If you:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">&lt;%=</span> <span class="n">form_for</span> <span class="no">Post</span><span class="o">.</span><span class="n">first</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="o">%&gt;</span> <span class="c1"># Will bring up the first Post object</span></code></pre></div>

<p>When doing so, that Post.first is calling
  method=&#39;POST&#39; with a route of &#39;/posts/id&#39; - which is not a listed route, therefore
  should not be valid.</p>

<p>But instead of erroring out, it is going to the post/update controller action.</p>

<p>Why?</p>

<p>This is bc the in addition to the Utf8 and the authenticity token, there is hidden
  method called _method = &#39;patch&#39;</p>

<p>_method is what Rails uses to determine which HTTP verb is used in the routes file
  or input method. This is because not every browser supports all HTTP methods, just most likely GET and POST.</p>

<ol>
<li><p>If the object is an existing object, Rails will automatically give it an
_method = &quot;PATCH&quot; and the route will become &#39;/post/id&#39;</p></li>
<li><p>The new post form and the edit post form can be identical because <em>method in form</em>for will take care of it.</p></li>
<li><p>Now you can create a partial to extract the form code that will be used for both
new and update partials</p></li>
</ol>

<p>So now:
    1. Create a partial called _form.html.erb under posts
    2. Extract common code</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">_form</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">erb</span>
        <span class="o">&lt;</span><span class="sx">% if </span><span class="vi">@post</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">any?</span> <span class="sx">%&gt;</span>
<span class="sx">          &lt;h5&gt;</span> <span class="no">There</span> <span class="n">were</span> <span class="n">some</span> <span class="ss">errors</span><span class="p">:</span> <span class="o">&lt;</span><span class="sr">/h5&gt;</span>
<span class="sr">          &lt;ul&gt;</span>
<span class="sr">            &lt;% @post.errors.full_messages.each do |msg|</span>
<span class="sr">            &lt;div class=&#39;alert alert-error&#39;&gt;</span>
<span class="sr">                &lt;li&gt;&lt;% msg %&gt; &lt;/</span><span class="n">li</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="sx">% end %&gt;</span>
<span class="sx">            &lt;/div&gt;</span>
          <span class="o">&lt;</span><span class="sr">/ul&gt;</span>
<span class="sr">        &lt;% end %&gt;</span></code></pre></div>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">&lt;</span><span class="n">h4</span><span class="o">&gt;</span> <span class="no">Rails</span> <span class="n">model</span><span class="o">-</span><span class="n">backed</span> <span class="n">form</span> <span class="n">helpers</span> <span class="o">&lt;</span><span class="sr">/h4&gt;</span>
<span class="sr">      &lt;%= form_for @post do |f| %&gt; # @post could also be Post.new</span>
<span class="sr">      &lt;%= f.label :title %&gt;</span>
<span class="sr">      &lt;%= f.text_field :title %&gt;</span>

<span class="sr">      &lt;%= f.label :url %&gt;</span>
<span class="sr">      &lt;%= f.text_field :title %&gt;</span>
<span class="sr">      &lt;br/</span><span class="o">&gt;</span>
      <span class="o">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="vi">@post</span><span class="o">.</span><span class="n">new_record?</span> <span class="p">?</span> <span class="s2">&quot;Create Post&quot;</span> <span class="p">:</span> <span class="s2">&quot;Update Post&quot;</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span>
      <span class="s1">&#39;btn btn-primary&#39;</span> <span class="sx">%&gt;</span>
<span class="sx">    &lt;% end %&gt;</span></code></pre></div>

<ol>
<li>Then update new_html.erb</li>
</ol>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">&lt;</span><span class="n">h3</span><span class="o">&gt;</span> <span class="no">Creating</span> <span class="n">a</span> <span class="no">Post</span> <span class="o">&lt;</span><span class="sr">/h3&gt;</span>
<span class="sr">  &lt;%= render &#39;form&#39; %&gt;</span></code></pre></div>

<ol>
<li>Then do the same for edit.html.erb</li>
</ol>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">&lt;</span><span class="n">h3</span><span class="o">&gt;</span> <span class="no">Edit</span> <span class="n">a</span> <span class="no">Post</span> <span class="o">&lt;</span><span class="sr">/h3&gt;</span>
<span class="sr">  &lt;%= render &#39;form&#39; %&gt;</span></code></pre></div>
<div class="highlight"><pre><code class="language-text" data-lang="text">  BUT you must also ensure that you have all your necessary instance variables
  created so in your controller
</code></pre></div>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">edit</span>
        <span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
      <span class="k">end</span></code></pre></div>
<div class="highlight"><pre><code class="language-text" data-lang="text">  which will route to &#39;post/:id/edit&#39;... named route edit_post_path(post)
</code></pre></div>
<h2>UPDATE</h2>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">update</span>
    <span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>

    <span class="k">if</span> <span class="vi">@post</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">post_params</span><span class="p">)</span>
      <span class="n">flash</span><span class="o">[</span><span class="ss">:notice</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;The post has been updated&quot;</span>
      <span class="n">redirect_to</span> <span class="n">posts_path</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:edit</span>
    <span class="k">end</span>
  <span class="k">end</span></code></pre></div>

<p>Remember since your _form.html.erb is being used by four actions:
new, create, edit, and update,
So you have to make sure you have @post defined in each action in your controller
or an exception will be thrown. Consequences of dry.</p>

<h2>Before_action</h2>

<p>For Rails 4, its before<em>action
For Rails 3, its before</em>filter</p>

<p>Since we are using @post = Post.find(params[:id])
several times in our controller by various actions (show, edit, and update), we should create a method called set<em>post and pass it the before</em>action, then we can remove @post from those</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">PostController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
<span class="n">before_action</span> <span class="ss">:set_post</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:show</span><span class="p">,</span> <span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="o">]</span>

  <span class="k">def</span> <span class="nf">show</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">edit</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">set_post</span>
    <span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>We use before_actions for two reasons
1. Set up an instance variable
2. Set up a redirect based on some condition (authentication)</p>

<h2>Nested Resources</h2>

<h3>Nested Routes</h3>

<ul>
<li>Redirect =&gt; URL</li>
<li>Render =&gt; template</li>
</ul>

<p>How to create a comment on the Show Post page:</p>

<h3>Routes File:</h3>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">resources</span> <span class="ss">:posts</span><span class="p">,</span> <span class="ss">except</span><span class="p">:</span> <span class="o">[</span><span class="ss">:destroy</span><span class="o">]</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:comments</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:create</span><span class="o">]</span>
<span class="k">end</span></code></pre></div>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">show</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">erb</span> <span class="p">(</span><span class="n">show</span> <span class="n">posts</span> <span class="n">page</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">h5</span><span class="o">&gt;</span> <span class="no">Create</span> <span class="n">a</span> <span class="no">Comment</span> <span class="o">&lt;</span><span class="sr">/h5&gt;</span>

<span class="sr">  &lt;%= form_for [@post, @ comment] %&gt;</span>
<span class="sr">    &lt;%= f.text_area :body %&gt;</span>
<span class="sr">    &lt;br/</span><span class="o">&gt;</span>
      <span class="o">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="s2">&quot;Create Comment&quot;</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">&quot;btn btn-primary&quot;</span> <span class="sx">%&gt;</span>
<span class="sx">  &lt;% end %&gt;</span></code></pre></div>

<p>&#39;/posts/3/comments&#39;
* We are trying to @post must be an existing post and @comment has to be an existing
comment.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">PostsController</span><span class="o">.</span><span class="n">rb</span>
<span class="k">def</span> <span class="nf">show</span>
  <span class="vi">@comment</span> <span class="o">=</span> <span class="no">Comment</span><span class="o">.</span><span class="n">new</span>
<span class="k">end</span></code></pre></div>

<h3>Create a CommentsController</h3>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">comments_controller</span><span class="o">.</span><span class="n">rb</span>

<span class="k">class</span> <span class="nc">CommentsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

<span class="k">def</span> <span class="nf">create</span>
  <span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:post_id</span><span class="o">]</span><span class="p">)</span> <span class="c1">#Always run params in binding.pry (in your controller) to check the attribute name. Nested routes always have the parent route appended to the id, therefore it would be &#39;post_id&#39;</span>

  <span class="vi">@comment</span> <span class="o">=</span> <span class="no">Comment</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:comment</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:body</span><span class="p">))</span>

  <span class="c1">#we could also associate comment and post</span>
      <span class="vi">@comment</span><span class="o">.</span><span class="n">post</span> <span class="o">=</span> <span class="vi">@post</span><span class="o">.</span><span class="n">comments</span>
      <span class="ow">or</span>
      <span class="n">you</span> <span class="n">could</span> <span class="n">change</span> <span class="n">the</span> <span class="n">above</span> <span class="n">line</span> <span class="k">for</span> <span class="err">@</span> <span class="n">comments</span> <span class="n">to</span> <span class="n">create</span> <span class="n">an</span> <span class="k">in</span> <span class="n">memory</span> <span class="n">post</span><span class="o">.</span><span class="n">comment</span>
      <span class="n">object</span> <span class="n">with</span> <span class="n">that</span> <span class="n">has</span> <span class="n">the</span> <span class="n">post_id</span> <span class="n">already</span> <span class="n">filled</span> <span class="n">out</span><span class="o">.</span>
        <span class="vi">@comment</span> <span class="o">=</span> <span class="vi">@post</span><span class="o">.</span><span class="n">comments</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:comment</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:body</span><span class="p">))</span>
  <span class="k">if</span> <span class="vi">@comment</span><span class="o">.</span><span class="n">save</span>
    <span class="n">flash</span><span class="o">[</span><span class="ss">:notice</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;Your comment was added&quot;</span>
    <span class="n">redirect_to</span> <span class="n">post_path</span><span class="p">(</span><span class="vi">@post</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="n">render</span> <span class="s1">&#39;posts/show&#39;</span> <span class="c1">#must be a template file... you are trying to indicate</span>
                        <span class="n">where</span> <span class="n">the</span> <span class="n">file</span> <span class="n">is</span> <span class="n">located</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1">#typially, we would just create a seperate method for comment_params, we aren&#39;t doing</span>
<span class="n">that</span> <span class="n">because</span> <span class="n">we</span> <span class="n">aren</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">trying</span> <span class="n">to</span> <span class="n">reuse</span> <span class="n">this</span> <span class="n">line</span> <span class="n">of</span> <span class="n">code</span> <span class="k">for</span> <span class="n">the</span> <span class="no">Update</span> <span class="n">action</span><span class="p">,</span> <span class="n">only</span> <span class="n">create</span><span class="o">.</span>
<span class="k">end</span></code></pre></div>

<h2>CRUD</h2>

<p>CRUD is an acronym that stands for &quot;create&quot;, &quot;retrieve&quot;, &quot;update&quot; and &quot;delete&quot;. You&#39;ll hear many developers say something like &quot;we just need a CRUD web interface for tickets&quot;. This is what Rails gives us out of the box: an ability to perform basic CRUD actions on a resource as a web application. Below is how the default Rails actions map to CRUD:</p>

<ul>
<li>Create: new, create</li>
<li>Retrieve: index, show</li>
<li>Update: edit, update</li>
<li>Delete: destroy</li>
</ul>

<h2>Render vs Redirect</h2>

<p>You should also understand what a render is vs a redirect. Render compiles the template
into HTML and sends the HTML back as part of the response. Redirect sends back a URL
as part of the response; there&#39;s no HTML in a redirect. Most browsers follow the redirected
URL automatically, and a new request is issued. All redirects will eventually lead to rendering of some template, otherwise your browser will display a &quot;too many redirects&quot; error.</p>

<p>Why does the URL stay at /posts when there&#39;s a validation error? Shouldn&#39;t it be /posts/new?</p>

<p>The request URL is what&#39;s showing up in the address bar, not the response.
The response is processed by your browser. The request URL is shown in the address bar.</p>

<p>In the case of a new post form submission, the request URL is /posts.
This has nothing to do with the response sent back. The URL only changes on successful
post creation because in that case the response is a redirect, and your browser issues a
new request, which changes the address bar.</p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page18">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page16">Newer</a>
    
  
</div>
    </div>

  </body>
</html>
